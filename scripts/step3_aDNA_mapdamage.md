# Visualize damage at ends of aDNA samples using *mapDamage*

DNA extracted from historical or ancient samples has been degraded by the passage of time and environmental conditions. In general, aDNA fragments are short and there may be atypical nucleotide bases in the sequence due to oxidative and hydrolytic degradation. Nucleotide misincorporation patterns are caused by deaminated forms of cytosines (uracils); Jonsson et al. (2013) write: *"For instance, for one of the most popular protocols (Meyer and Kircher, 2010), we observe inflated cytosine deamination rates at 5'-overhangs, an increase in C -->T substitution rates toward sequencing starts and complementary increase in G -->A rates toward reads ends (Briggs et al., 2007)."* 

*mapDamage2* is a program which quantifies DNA damage patterns in ancient DNA sequences generated by high throughput sequencing. Real aDNA sequences should have some level of nucleotide misincorporation, and quantifying this is a way to authenticate that sequences represent aDNA and not exogeneous DNA contamination.

To learn how to install *mapDamage2* program, follow this link: https://ginolhac.github.io/mapDamage/
For the *mapDamage2* manuscript, go here: https://academic.oup.com/bioinformatics/article/29/13/1682/184965

## Run mapDamage2

Usage: *mapDamage [options] -i BAMfile -r reference.fasta*

Options for rescaling of BAM files:

  --rescale                     Rescale the quality scores in the BAM file using the output from the statistical estimation
  
  --rescale-out=<filename>    Write the rescaled BAM to this file
  
  --folder=<foldername> write the results to this folder

``` bash

# Directories and files

BASEDIR=/media/ubuntu/Herring_aDNA/hybridization_capture/ancient_samples
SAMPLELIST=$BASEDIR/sample_lists/sample_list.txt # Path to a text file with list of prefixes of the fastq files, separated by newline s
BAMDIR=$BASEDIR'/'bam # path to folder with bam files (output)
GENOMEDIR=/media/ubuntu/Herring_aDNA/atlantic_herring_genome # Path to genome.
GENOME=GCA_900700415.1_Ch_v2.0.2_genomic.fna #file name of genome
OUTDIR=$BASEDIR'/'mapdamage_bam

# Command to run mapDamage

for SAMPLEFILE in `cat $SAMPLELIST`
do
  mapDamage -i $BAMDIR'/'${SAMPLEFILE}'_sorted_rd.bam' \
  -r $GENOMEDIR'/'$GENOME \
  --rescale \
  --rescale-out=$OUTDIR'/'${SAMPLEFILE}'_sorted_rd_realign.bam' \
  --folder=$OUTDIR'/''results_'${SAMPLEFILE}
done

# Append the output of mapDamage to some text files for plotting all samples together

cd $OUTDIR #change to the directory containing the mapDamage results

for FOLDER in */ #for every folder in the current directory
do
  echo ${FOLDER} # check
  #remove the header in this file
	grep -v "pos" ${FOLDER}'/''3pGtoA_freq.txt' | \
	#append the remaining lines to a new file  
	cat  >>'3pGtoA_freq_allsamples.txt'
done


for FOLDER in */ #for every folder in the current directory
do
  echo ${FOLDER} # check
  #remove the header in this file
	grep -v "pos" ${FOLDER}'/''5pCtoT_freq.txt' | \
	#append the remaining lines to a new file  
	cat  >>'5pCtoT_freq_allsamples.txt'
done


```

## Plot output of mapDamage

I plotted the estimated 5' and 3' misincorporation frequency using an R script: [plot_mapdamage.R](plot_mapdamage.R)
